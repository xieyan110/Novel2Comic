# æ¼«ç”»æœåŠ¡ MCP æ¥å£

## é¡¹ç›®æ¦‚è¿°

åŸºäº Python çš„ MCP (Model Context Protocol) æ¥å£ï¼Œè®©å¤§æ¨¡å‹ï¼ˆAI å·¥å…·ï¼‰èƒ½å¤Ÿå°†å°è¯´/æ–‡æ¡ˆè½¬æ¢ä¸ºæ¼«ç”»ä½œå“ã€‚

**æ ¸å¿ƒç‰¹ç‚¹**ï¼š
- ğŸ“– AI å·¥å…·è´Ÿè´£ç†è§£æ–‡æœ¬å’Œç”Ÿæˆç»“æ„åŒ– JSON
- ğŸ¨ MCP æœåŠ¡è´Ÿè´£æä¾› Schema æ¨¡æ¿ã€ç”Ÿæˆå›¾ç‰‡
- ğŸ‘¥ é€šè¿‡å‚è€ƒå›¾æœºåˆ¶ç¡®ä¿äººç‰©å’Œåœºæ™¯çš„è§†è§‰ä¸€è‡´æ€§
- ğŸ¤– åŸºäº Gemini `gemini-3-pro-image-preview` æ¨¡å‹

## å·¥ä½œæµç¨‹

### æ ¸å¿ƒæ¦‚å¿µï¼šå°è¯´åˆ†æ®µ

**é‡è¦ï¼š**
- å°è¯´ä¼šè¢«åˆ†æˆå¤šæ®µ
- **æ¯ä¸€æ®µå°è¯´ = ä¸€ä¸ª JSON = ä¸€é¡µæ¼«ç”»å›¾ç‰‡**
- å°è¯´åˆ†å¤šå°‘æ®µ = ç”Ÿæˆå¤šå°‘é¡µæ¼«ç”»

**åˆ†æ®µç¤ºä¾‹ï¼š**
```
åŸå°è¯´ï¼š
"å°æ˜èµ°åœ¨è¡—ä¸Šã€‚çœ‹åˆ°äº†ä¸€åªå°çŒ«ã€‚ä»–è¯´ï¼šä½ å¥½å°çŒ«ã€‚å°çŒ«è·‘äº†ã€‚"

AI å·¥å…·å°†å…¶åˆ†ä¸º 3 æ®µï¼š
â”œâ”€ æ®µ1: "å°æ˜èµ°åœ¨è¡—ä¸Šã€‚"           â†’ JSON 1 â†’ page_001.jpg
â”œâ”€ æ®µ2: "å°æ˜çœ‹åˆ°äº†ä¸€åªå°çŒ«ï¼Œä»–è¯´ï¼šä½ å¥½å°çŒ«ã€‚" â†’ JSON 2 â†’ page_002.jpg
â””â”€ æ®µ3: "å°çŒ«å–µçš„ä¸€å£°è·‘å¼€äº†ã€‚"      â†’ JSON 3 â†’ page_003.jpg
```

### å®Œæ•´å·¥ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å®Œæ•´å·¥ä½œæµç¨‹                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç”¨æˆ·
  â”‚ å‘é€å°è¯´æ–‡æœ¬
  â”‚ "è¯·å°†è¿™æ®µå°è¯´è½¬æ¢ä¸ºæ¼«ç”»..."
  â†“

AI å·¥å…·ï¼ˆClaude/GPT ç­‰ï¼‰
  â”‚ â‘  è°ƒç”¨ get_workflow_guide è·å–å·¥ä½œæµç¨‹
  â”‚ â‘¡ è°ƒç”¨ get_json_schema è·å– JSON æ ¼å¼
  â”‚ â‘¢ åˆ†æå°è¯´ï¼Œè¯†åˆ«è§’è‰²å’Œåœºæ™¯
  â”‚ â‘£ å°†å°è¯´åˆ†æˆ N æ®µ
  â”‚ â‘¤ ä¸ºæ¯ä¸ªè§’è‰²ç”Ÿæˆå‚è€ƒå›¾ï¼ˆgenerate_character_referenceï¼‰
  â”‚ â‘¥ ä¸ºæ¯ä¸ªåœºæ™¯ç”Ÿæˆå‚è€ƒå›¾ï¼ˆgenerate_scene_referenceï¼‰
  â”‚ â‘¦ ä¸ºæ¯æ®µå°è¯´ç”Ÿæˆå¯¹åº”çš„ JSON
  â”‚ â‘§ å¯¹æ¯ä¸ª JSON è°ƒç”¨ generate_comic_page(page_json)
  â†“

MCP æœåŠ¡ï¼ˆPythonï¼‰
  â”‚ â‘¨ æ¥æ”¶ JSON
  â”‚ â‘© æå–è§’è‰²å’Œåœºæ™¯
  â”‚ â‘ª å‡†å¤‡å‚è€ƒå›¾ï¼ˆå·²æœ‰æˆ–è‡ªåŠ¨åˆ›å»ºï¼‰
  â”‚ â‘« è°ƒç”¨ Gemini API ç”Ÿæˆå›¾ç‰‡
  â”‚ â‘¬ è¿”å›å›¾ç‰‡åœ°å€
  â†“

AI å·¥å…·
  â”‚ â‘­ æ”¶åˆ°å›¾ç‰‡åœ°å€ï¼Œå±•ç¤ºç»™ç”¨æˆ·
  â”‚ "âœ… æ¼«ç”»å·²ç”Ÿæˆï¼š./output/pages/page_001.jpg"
  â”‚ "âœ… æ¼«ç”»å·²ç”Ÿæˆï¼š./output/pages/page_002.jpg"
  â”‚ "âœ… æ¼«ç”»å·²ç”Ÿæˆï¼š./output/pages/page_003.jpg"
  â†“

ç”¨æˆ·
  æŸ¥çœ‹ç”Ÿæˆçš„æ¼«ç”»å›¾ç‰‡ï¼ˆå…± N é¡µï¼‰
```

### åˆ†æ®µåŸåˆ™

AI å·¥å…·åœ¨åˆ†æ®µæ—¶åº”è€ƒè™‘ï¼š
- æ¯æ®µæ˜¯ç›¸å¯¹å®Œæ•´çš„æƒ…èŠ‚å•å…ƒ
- å¯¹è¯å¯†åº¦ï¼šå¯¹è¯å¤šçš„æ®µè½å¯ä»¥å•ç‹¬ä¸€é¡µ
- ä¸€èˆ¬æ¯æ®µåŒ…å« 2-4 ä¸ªåˆ†é•œï¼ˆpanelsï¼‰
- é¿å…å•æ®µå†…å®¹è¿‡å¤šæˆ–è¿‡å°‘

## MCP å·¥å…·åˆ—è¡¨

### å·¥ä½œæµç¨‹å·¥å…·ï¼ˆ2ä¸ªï¼‰

| å·¥å…·å | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|--------|------|----------|
| `get_workflow_guide` | è·å–å·¥ä½œæµç¨‹æŒ‡å¼• | é¦–æ¬¡ä½¿ç”¨ï¼Œäº†è§£å®Œæ•´æµç¨‹ |
| `get_json_schema` | è·å– JSON Schema å’Œç¤ºä¾‹ | äº†è§£å¦‚ä½•æ ¼å¼åŒ–æ¼«ç”»æ•°æ® |

### å‚è€ƒå›¾ç”Ÿæˆå·¥å…·ï¼ˆ2ä¸ªï¼‰

| å·¥å…·å | è¯´æ˜ | å‚æ•° |
|--------|------|------|
| `generate_character_reference` | ç”Ÿæˆäººç‰©å‚è€ƒå›¾ | character_name, description, visual_features |
| `generate_scene_reference` | ç”Ÿæˆåœºæ™¯å‚è€ƒå›¾ | scene_name, description, tags |

### æ ¸å¿ƒå·¥å…·ï¼ˆ2ä¸ªï¼‰

| å·¥å…·å | è¯´æ˜ | å‚æ•° |
|--------|------|------|
| `generate_comic_page` | ç”Ÿæˆå•é¡µæ¼«ç”»å›¾ç‰‡ | page_jsonï¼ˆJSONå­—ç¬¦ä¸²ï¼‰, image_size, aspect_ratio |
| `batch_generate_pages` | æ‰¹é‡ç”Ÿæˆå¤šé¡µ | pages_jsonï¼ˆJSONæ•°ç»„ï¼‰, concurrent_limit |

### ç®¡ç†å·¥å…·ï¼ˆ3ä¸ªï¼‰

| å·¥å…·å | è¯´æ˜ |
|--------|------|
| `list_characters` | åˆ—å‡ºæ‰€æœ‰å·²åˆ›å»ºçš„è§’è‰² |
| `list_scenes` | åˆ—å‡ºæ‰€æœ‰å·²åˆ›å»ºçš„åœºæ™¯ |
| `update_character_reference` | æ›´æ–°äººç‰©å‚è€ƒå›¾ |

## JSON Schema æ ¼å¼

### åŸºæœ¬ç»“æ„

```json
{
  "page_number": 1,
  "panels": [
    {
      "panel_number": 1,
      "description": "è¯¦ç»†çš„ç”»é¢æè¿°...",
      "characters": [
        {
          "name": "è§’è‰²å",
          "action": "åŠ¨ä½œæè¿°",
          "expression": "è¡¨æƒ…",
          "position_hint": "ä½ç½®æç¤º"
        }
      ],
      "dialogues": [
        {
          "speaker": "è¯´è¯äºº",
          "text": "å¯¹è¯å†…å®¹",
          "emotion": "æƒ…ç»ª"
        }
      ],
      "background": "åœºæ™¯åç§°",
      "camera_angle": "é•œå¤´è§’åº¦",
      "sound_effects": ["éŸ³æ•ˆ"],
      "mood": "æ•´ä½“æ°›å›´"
    }
  ]
}
```

### å®Œæ•´ç¤ºä¾‹

```json
{
  "page_number": 1,
  "panels": [
    {
      "panel_number": 1,
      "description": "ç°ä»£åŸå¸‚è¡—é“ï¼Œé˜³å…‰æ˜åªšã€‚ä¸€ä¸ªåå²ç”·å­©ï¼ˆå°æ˜ï¼‰èµ°åœ¨äººè¡Œé“ä¸Šï¼Œä¸¤ä¾§æ˜¯ç»¿æ ‘å’Œå»ºç­‘ç‰©ã€‚æ—¥æ¼«é£æ ¼ï¼Œè‰²å½©æ˜äº®ã€‚",
      "characters": [
        {
          "name": "å°æ˜",
          "action": "è¡Œèµ°",
          "expression": "è½»æ¾",
          "position_hint": "ç”»é¢ä¸­å¤®ï¼Œç•¥å¾®åå·¦"
        }
      ],
      "dialogues": [],
      "background": "ç°ä»£åŸå¸‚è¡—é“",
      "camera_angle": "å…¨æ™¯",
      "mood": "è½»æ¾æ„‰å¿«"
    },
    {
      "panel_number": 2,
      "description": "ä¸­æ™¯é•œå¤´ã€‚å°æ˜è¹²ä¸‹èº«ï¼Œå¾®ç¬‘ç€ä¼¸å‡ºå³æ‰‹ã€‚å‰æ–¹æœ‰ä¸€åªæ©˜è‰²å°çŒ«ï¼Œæ¯›èŒ¸èŒ¸çš„ï¼Œæ­£æŠ¬å¤´çœ‹ç€ä»–ã€‚èƒŒæ™¯æ˜¯è¡—é“ï¼Œè™šåŒ–å¤„ç†ã€‚",
      "characters": [
        {
          "name": "å°æ˜",
          "action": "è¹²ä¸‹ï¼Œä¼¸æ‰‹",
          "expression": "æ¸©æŸ”å¾®ç¬‘",
          "position_hint": "ç”»é¢å·¦ä¾§"
        }
      ],
      "dialogues": [
        {
          "speaker": "å°æ˜",
          "text": "ä½ å¥½å•Šï¼Œå°å®¶ä¼™ï¼",
          "emotion": "å–œæ‚¦"
        }
      ],
      "background": "è¡—é“èƒŒæ™¯",
      "camera_angle": "ä¸­æ™¯",
      "mood": "æ¸©é¦¨"
    }
  ]
}
```

## ä½¿ç”¨ç¤ºä¾‹

### å¯¹è¯å¼ä½¿ç”¨ï¼ˆæ¨èï¼‰

å½“ç”¨æˆ·å‘ AI å·¥å…·å‘é€è¯·æ±‚æ—¶ï¼ŒAI ä¼šè‡ªåŠ¨è°ƒç”¨ MCP å·¥å…·å®Œæˆæ•´ä¸ªæµç¨‹ï¼š

```
ç”¨æˆ·ï¼š
è¯·å°†è¿™æ®µå°è¯´è½¬æ¢ä¸ºæ¼«ç”»ï¼š

å°æ˜èµ°åœ¨è¡—é“ä¸Šï¼Œçœ‹åˆ°äº†ä¸€åªå°çŒ«ã€‚
"ä½ å¥½å•Šï¼Œå°å®¶ä¼™ï¼"å°æ˜ç¬‘ç€è¯´ã€‚
å°çŒ«"å–µ"çš„ä¸€å£°è·‘å¼€äº†ã€‚

---

AI å·¥å…·ä¼šè‡ªåŠ¨æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

ã€ç¬¬ä¸€é˜¶æ®µï¼šåˆ†æå°è¯´ã€‘
1. [è°ƒç”¨ get_workflow_guide] äº†è§£å·¥ä½œæµç¨‹
2. [è°ƒç”¨ get_json_schema] äº†è§£ JSON æ ¼å¼
3. [åˆ†æå°è¯´] è¯†åˆ«å‡º 1 ä¸ªè§’è‰²ï¼ˆå°æ˜ï¼‰ã€1 ä¸ªåœºæ™¯ï¼ˆè¡—é“ï¼‰
4. [åˆ†æ®µ] å°†å°è¯´åˆ†ä¸º 3 æ®µï¼š
   - æ®µ1: "å°æ˜èµ°åœ¨è¡—é“ä¸Š"
   - æ®µ2: "å°æ˜çœ‹åˆ°äº†ä¸€åªå°çŒ«ï¼Œè¯´ï¼šä½ å¥½å•Šï¼Œå°å®¶ä¼™ï¼"
   - æ®µ3: "å°çŒ«å–µçš„ä¸€å£°è·‘å¼€äº†"

ã€ç¬¬äºŒé˜¶æ®µï¼šç”Ÿæˆå‚è€ƒå›¾ã€‘
5. [è°ƒç”¨ generate_character_reference] ä¸º"å°æ˜"ç”Ÿæˆå‚è€ƒå›¾
6. [è°ƒç”¨ generate_scene_reference] ä¸º"è¡—é“"ç”Ÿæˆå‚è€ƒå›¾

ã€ç¬¬ä¸‰é˜¶æ®µï¼šç”Ÿæˆæ¼«ç”»ã€‘
7. [ä¸ºæ®µ1ç”Ÿæˆ JSON] page_number=1, 2ä¸ªåˆ†é•œ
8. [è°ƒç”¨ generate_comic_page(JSON1)] â†’ ç”Ÿæˆ page_001.jpg

9. [ä¸ºæ®µ2ç”Ÿæˆ JSON] page_number=2, 2ä¸ªåˆ†é•œ
10. [è°ƒç”¨ generate_comic_page(JSON2)] â†’ ç”Ÿæˆ page_002.jpg

11. [ä¸ºæ®µ3ç”Ÿæˆ JSON] page_number=3, 1ä¸ªåˆ†é•œ
12. [è°ƒç”¨ generate_comic_page(JSON3)] â†’ ç”Ÿæˆ page_003.jpg

ã€è¿”å›ç»“æœã€‘
âœ… æ¼«ç”»å·²ç”Ÿæˆï¼Œå…± 3 é¡µï¼š
âœ… ç¬¬1é¡µ: ./output/pages/page_001.jpg
âœ… ç¬¬2é¡µ: ./output/pages/page_002.jpg
âœ… ç¬¬3é¡µ: ./output/pages/page_003.jpg
```

### åˆ†æ®µç¤ºä¾‹è¯¦è§£

å‡è®¾æœ‰ä¸€æ®µè¾ƒé•¿çš„å°è¯´ï¼š

```
åŸå°è¯´ï¼š
"å°æ˜èµ°åœ¨è¡—é“ä¸Šï¼Œå¤©æ°”å¾ˆå¥½ã€‚çªç„¶ï¼Œä»–çœ‹åˆ°å‰æ–¹æœ‰ä¸€åªå°çŒ«ã€‚
ä»–èµ°è¿‡å»è¹²ä¸‹ï¼Œå¾®ç¬‘ç€è¯´ï¼šä½ å¥½å•Šï¼Œå°å®¶ä¼™ï¼
å°çŒ«çœ‹äº†ä»–ä¸€çœ¼ï¼Œç„¶åå–µçš„ä¸€å£°è·‘å¼€äº†ã€‚
å°æ˜ç«™èµ·èº«ï¼Œç¬‘ç€æ‘‡äº†æ‘‡å¤´ï¼Œç»§ç»­å¾€å‰èµ°ã€‚"
```

**AI å·¥å…·çš„åˆ†æ®µå¤„ç†ï¼š**

| æ®µè½ | å†…å®¹ | åˆ†é•œæ•° | page_number | è¾“å‡º |
|------|------|--------|-------------|------|
| æ®µ1 | å°æ˜èµ°åœ¨è¡—é“ä¸Šï¼Œå¤©æ°”å¾ˆå¥½ã€‚çªç„¶ï¼Œä»–çœ‹åˆ°å‰æ–¹æœ‰ä¸€åªå°çŒ«ã€‚ | 2ä¸ªåˆ†é•œ | 1 | page_001.jpg |
| æ®µ2 | ä»–èµ°è¿‡å»è¹²ä¸‹ï¼Œå¾®ç¬‘ç€è¯´ï¼šä½ å¥½å•Šï¼Œå°å®¶ä¼™ï¼ | 2ä¸ªåˆ†é•œ | 2 | page_002.jpg |
| æ®µ3 | å°çŒ«çœ‹äº†ä»–ä¸€çœ¼ï¼Œç„¶åå–µçš„ä¸€å£°è·‘å¼€äº†ã€‚ | 1ä¸ªåˆ†é•œ | 3 | page_003.jpg |
| æ®µ4 | å°æ˜ç«™èµ·èº«ï¼Œç¬‘ç€æ‘‡äº†æ‘‡å¤´ï¼Œç»§ç»­å¾€å‰èµ°ã€‚ | 1ä¸ªåˆ†é•œ | 4 | page_004.jpg |

**æ¯ä¸ªæ®µè½ç‹¬ç«‹ç”Ÿæˆä¸€ä¸ª JSONï¼Œç‹¬ç«‹ç”Ÿæˆä¸€å¼ å›¾ç‰‡ã€‚**

### æ‰‹åŠ¨è°ƒç”¨å·¥å…·

å¦‚æœä½ æƒ³æ‰‹åŠ¨æ§åˆ¶æ¯ä¸ªæ­¥éª¤ï¼š

```python
# ç¬¬ä¸€æ­¥ï¼šç”Ÿæˆè§’è‰²å‚è€ƒå›¾
generate_character_reference(
    character_name="å°æ˜",
    description="10å²ç”·å­©ï¼Œé»‘è‰²çŸ­å‘ï¼Œç©¿ç€è“è‰²Tæ¤å’Œç‰›ä»”è£¤"
)

# ç¬¬äºŒæ­¥ï¼šç”Ÿæˆåœºæ™¯å‚è€ƒå›¾
generate_scene_reference(
    scene_name="è¡—é“",
    description="ç°ä»£åŸå¸‚è¡—é“ï¼Œé˜³å…‰æ˜åªšï¼Œæœ‰æ ‘æœ¨å’Œå»ºç­‘ç‰©"
)

# ç¬¬ä¸‰æ­¥ï¼šå‡†å¤‡ JSON
page_json = '''
{
  "page_number": 1,
  "panels": [...]
}
'''

# ç¬¬å››æ­¥ï¼šç”Ÿæˆæ¼«ç”»
generate_comic_page(page_json=page_json)
```

## äººç‰©ä¸€è‡´æ€§ä¿è¯

MCP æœåŠ¡é€šè¿‡**å‚è€ƒå›¾æœºåˆ¶**ç¡®ä¿äººç‰©è§†è§‰ä¸€è‡´æ€§ï¼š

1. **é¦–æ¬¡åˆ›å»º**ï¼šè°ƒç”¨ `generate_character_reference` ç”Ÿæˆè§’è‰²å‚è€ƒå›¾
2. **åç»­ä½¿ç”¨**ï¼šåœ¨ JSON ä¸­ä½¿ç”¨ç›¸åŒçš„ `name` å­—æ®µå¼•ç”¨è§’è‰²
3. **è‡ªåŠ¨å…³è”**ï¼šMCP æœåŠ¡ä¼šè‡ªåŠ¨æŸ¥æ‰¾å¹¶ä½¿ç”¨å¯¹åº”çš„å‚è€ƒå›¾
4. **è§†è§‰ä¸€è‡´**ï¼šGemini API ä¼šå‚è€ƒåŸå›¾ç”Ÿæˆæ–°å›¾ç‰‡

ç¤ºä¾‹ï¼š
```json
// ç¬¬ä¸€æ¬¡ä¸º"å°æ˜"ç”Ÿæˆå‚è€ƒå›¾å
{
  "panel_number": 1,
  "characters": [{"name": "å°æ˜", ...}]  // è‡ªåŠ¨ä½¿ç”¨å‚è€ƒå›¾
}
```

## æŠ€æœ¯æ¶æ„

```
comic_service/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ mcp_server.py           # MCP æœåŠ¡å™¨ï¼ˆ9ä¸ªå·¥å…·ï¼‰
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ schemas.py          # JSON Schema å®šä¹‰å’Œå·¥ä½œæµç¨‹æŒ‡å¼•
â”‚   â”‚   â”œâ”€â”€ comic_schema.py     # Pydantic æ•°æ®æ¨¡å‹ï¼ˆPage, Panelç­‰ï¼‰
â”‚   â”‚   â””â”€â”€ character.py        # äººç‰©/åœºæ™¯æ•°æ®æ¨¡å‹
â”‚   â””â”€â”€ image_gen/
â”‚       â”œâ”€â”€ gemini_client.py    # Gemini API å®¢æˆ·ç«¯
â”‚       â”œâ”€â”€ character_manager.py # äººç‰©å‚è€ƒå›¾ç®¡ç†
â”‚       â””â”€â”€ scene_manager.py    # åœºæ™¯å‚è€ƒå›¾ç®¡ç†
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ gemini_config.json     # Gemini API é…ç½®
â”‚   â””â”€â”€ references/            # å‚è€ƒå›¾å­˜å‚¨
â”‚       â”œâ”€â”€ characters/        # äººç‰©å‚è€ƒå›¾
â”‚       â””â”€â”€ scenes/            # åœºæ™¯å‚è€ƒå›¾
â””â”€â”€ output/
    â””â”€â”€ pages/                 # ç”Ÿæˆçš„æ¼«ç”»å›¾ç‰‡
```

## é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
GEMINI_API_KEY=your_api_key_here
GEMINI_API_BASE_URL=https://generativelanguage.googleapis.com
GEMINI_MODEL=gemini-3-pro-image-preview
```

### Gemini API é…ç½®

`config/gemini_config.json`ï¼š

```json
{
  "api_base_url": "https://generativelanguage.googleapis.com",
  "api_key": "YOUR_API_KEY_HERE",
  "model": "gemini-3-pro-image-preview",
  "storage": {
    "reference_images_path": "./config/references",
    "output_images_path": "./output/pages"
  }
}
```

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### 2. é…ç½® API Key

```bash
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥ Gemini API Key
```

### 3. å¯åŠ¨ MCP æœåŠ¡å™¨

```bash
python start_server.py
```

### 4. é…ç½® Claude Desktopï¼ˆå¯é€‰ï¼‰

ç¼–è¾‘ `~/Library/Application Support/Claude/claude_desktop_config.json`ï¼š

```ps1
claude mcp add python C:\Work\comic_service\start_server.py -t stdio comic-service -e "GEMINI_API_KEY=sk-xxxxxxx"
```

```json
{
  "mcpServers": {
    "comic-service": {
      "command": "python",
      "args": ["/path/to/comic_service/start_server.py"],
      "env": {
        "GEMINI_API_KEY": "your_api_key_here"
      }
    }
  }
}
```

### 5. ä½¿ç”¨

ç›´æ¥åœ¨ Claude ä¸­å¯¹è¯ï¼š

```
"è¯·å°†ä»¥ä¸‹å°è¯´è½¬æ¢ä¸ºæ¼«ç”»ï¼š

[å°è¯´å†…å®¹]

å…ˆä¸ºè§’è‰²ç”Ÿæˆå‚è€ƒå›¾ï¼Œç„¶åç”Ÿæˆç¬¬ä¸€é¡µçš„æ¼«ç”»ã€‚"
```

Claude ä¼šè‡ªåŠ¨è°ƒç”¨ MCP å·¥å…·å®Œæˆæ•´ä¸ªæµç¨‹ã€‚

## å…³é”®è®¾è®¡å†³ç­–

### ä¸ºä»€ä¹ˆ JSON ç”± AI ç”Ÿæˆï¼Ÿ

âœ… **ä¼˜ç‚¹**ï¼š
- AI æ›´ç†è§£æ–‡æœ¬ï¼Œèƒ½æ›´å¥½åœ°æå–å¯¹è¯ã€åŠ¨ä½œã€æƒ…ç»ª
- AI å¯ä»¥çµæ´»è°ƒæ•´åˆ†é•œç»“æ„
- MCP æœåŠ¡ä¸“æ³¨äºå›¾ç‰‡ç”Ÿæˆï¼ŒèŒè´£æ¸…æ™°
- å‡å°‘ MCP æœåŠ¡ä¸ AI çš„äº¤äº’æ¬¡æ•°

âŒ **å¦‚æœ MCP ç”Ÿæˆ JSON**ï¼š
- éœ€è¦ MCP è°ƒç”¨ AI å¤šæ¬¡ï¼ˆåˆ†æâ†’ç”Ÿæˆâ†’éªŒè¯â†’ä¿®æ­£ï¼‰
- å¢åŠ  Token æ¶ˆè€—
- æµç¨‹å¤æ‚ï¼Œéš¾ä»¥æ§åˆ¶

### ä¸ºä»€ä¹ˆè‡ªåŠ¨åˆ›å»ºå‚è€ƒå›¾ï¼Ÿ

åœ¨ `generate_comic_page` ä¸­ï¼Œå¦‚æœå‘ç°è§’è‰²æˆ–åœºæ™¯æ²¡æœ‰å‚è€ƒå›¾ï¼Œä¼š**è‡ªåŠ¨åˆ›å»º**ï¼š
- ç®€åŒ–æµç¨‹ï¼Œç”¨æˆ·æ— éœ€æ‰‹åŠ¨ç®¡ç†
- ç¡®ä¿äººç‰©ä¸€è‡´æ€§ï¼Œå³ä½¿å¿˜è®°æå‰åˆ›å»º
- å¯ä»¥ä½¿ç”¨ `update_character_reference` åç»­ä¼˜åŒ–

## ç¤ºä¾‹é¡¹ç›®

æŸ¥çœ‹ `examples/` ç›®å½•ï¼š

- `USAGE_EXAMPLES.md` - è¯¦ç»†ä½¿ç”¨ç¤ºä¾‹
- `test_gemini_client.py` - API æµ‹è¯•è„šæœ¬

## å¸¸è§é—®é¢˜

### Q: å¦‚ä½•ç¡®ä¿äººç‰©ä¸€è‡´æ€§ï¼Ÿ

A: ä½¿ç”¨ç›¸åŒçš„ `name` å­—æ®µå¼•ç”¨è§’è‰²ã€‚MCP ä¼šè‡ªåŠ¨æŸ¥æ‰¾å¹¶ä½¿ç”¨å‚è€ƒå›¾ã€‚

### Q: å¯ä»¥ä¿®æ”¹å·²ç”Ÿæˆçš„è§’è‰²å‚è€ƒå›¾å—ï¼Ÿ

A: å¯ä»¥ï¼Œä½¿ç”¨ `update_character_reference` å·¥å…·ã€‚

### Q: å¦‚ä½•æ‰¹é‡ç”Ÿæˆå¤šé¡µï¼Ÿ

A: ä½¿ç”¨ `batch_generate_pages` å·¥å…·ï¼Œä¼ å…¥ JSON æ•°ç»„ã€‚

### Q: å›¾ç‰‡ç”Ÿæˆé€Ÿåº¦æ…¢æ€ä¹ˆåŠï¼Ÿ

A: è°ƒæ•´ `image_size` å‚æ•°ï¼ˆä½¿ç”¨ 2K æˆ– 1Kï¼‰ï¼Œæˆ–å‡å°‘ `concurrent_limit`ã€‚

### Q: æ”¯æŒå“ªäº›å›¾ç‰‡æ ¼å¼ï¼Ÿ

A: ç›®å‰è¾“å‡º JPEG æ ¼å¼ï¼Œä¿å­˜åœ¨ `output/pages/` ç›®å½•ã€‚

## åç»­ä¼˜åŒ–æ–¹å‘

- [ ] æ”¯æŒå•é¡µå¤šä¸ªåˆ†é•œï¼ˆç›®å‰æ‰€æœ‰åˆ†é•œåˆå¹¶ä¸ºä¸€å¼ å›¾ï¼‰
- [ ] æ·»åŠ å¯¹è¯æ°”æ³¡æ¸²æŸ“
- [ ] æ”¯æŒå¤šç§å›¾ç‰‡ç”Ÿæˆæ¨¡å‹
- [ ] æ·»åŠ å›¾ç‰‡åæœŸå¤„ç†ï¼ˆè‰²è°ƒã€æ»¤é•œï¼‰
- [ ] å®ç°é¡¹ç›®å¯¼å‡ºï¼ˆæ‰“åŒ… JSON + å›¾ç‰‡ï¼‰

## å‚è€ƒæ–‡æ¡£

- **Gemini API**: https://ai.google.dev/docs
- **MCP åè®®**: https://modelcontextprotocol.io/docs
- **ç°æœ‰å®ç°**: [app.js](app.js) (Gemini API è°ƒç”¨ç¤ºä¾‹)

## License

MIT
